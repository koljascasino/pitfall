var App=function(){"use strict";return{}}();$(function(){var a=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;if(a){var b=new a,c=new App.Music(b),d=new App.Ui(c),e=new Phaser.Game(900,600,Phaser.AUTO,"canvas_container"),f=new App.GameState(d,c,e,900,600);e.state.add("game",f,!0)}else $("#loader").addClass("hidden"),$("#header").text("ERROR"),$("#text").text("This game requires a browser which supports WebAudio.")}),function(a){"use strict";var b=function(a){this.music=a,this.touch=!1,this.orientation=null;var b=function(a){var b=null;a.beta>30?b=a.gamma:a.gamma<-30?b=a.beta:a.gamma>30&&(b=-a.beta),null!==b&&(this.orientation=Math.max(Math.min(b/20,1),-1))}.bind(this);window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",b);var c=null;c=function(){$("#splashscreen").unbind("touchend",c),this.touch=!0}.bind(this),$("#splashscreen").bind("touchend",c)};b.prototype.loadScreen=function(a,b){var c=function(c){if(c.preventDefault(),c.stopPropagation(),$("#player").hasClass("fullscreen")){$("#player").removeClass("fullscreen"),$(".help").removeClass("hidden"),null===this.orientation?$(".deviceorientation-on").addClass("hidden"):$(".deviceorientation-off").addClass("hidden"),this.showSplashScreen("","Loading audio");var d=function(){$("#player_pause").removeClass("hidden"),this.startScreen(a,b)}.bind(this);this.music.load(1,d)}else this.music.mute(),$(".playerbutton").toggleClass("hidden")}.bind(this);this.addHandler($("#player"),c,!1),$("#splashscreen").addClass("hidden"),$("#player").removeClass("hidden")},b.prototype.startScreen=function(a,b){$("#loader").addClass("hidden"),this.showSplashScreen("","Press any key to start your mission."),this.setSplashScreenHandler(a,b)},b.prototype.levelScreen=function(a,b,c){this.showSplashScreen("Stage complete!","Loading audio");var d=function(){this.showSplashScreen("Stage complete!","Press any key to continue your mission."),this.setSplashScreenHandler(b,c)}.bind(this);this.music.load(a,d)},b.prototype.pauseScreen=function(a,b){this.showSplashScreen("Paused","Press any key to continue."),this.setSplashScreenHandler(a,b)},b.prototype.gameOverScreen=function(a,b){this.showSplashScreen("GAME OVER","");var c=function(){this.showSplashScreen("GAME OVER","Press any key to restart"),this.setSplashScreenHandler(a,b)}.bind(this);setTimeout(c,3e3)},b.prototype.winScreen=function(a,b){this.showSplashScreen("WELL DONE EARTHLING!","You made it to the core of the planet.");var c=function(){this.showSplashScreen("WELL DONE EARTHLING!","Press any key to restart"),this.setSplashScreenHandler(a,b)}.bind(this);setTimeout(c,6e4)},b.prototype.showSplashScreen=function(a,b){$("#header").text(a),$("#text").text(b),$("#splashscreen").removeClass("hidden")},b.prototype.setSplashScreenHandler=function(a,b){var c=function(){this.hideSplashScreen(a,b)}.bind(this);this.addHandler($("#splashscreen"),c,!0)},b.prototype.hideSplashScreen=function(a,b){this.music.stopTracks(1.1);var c=setInterval(function(){$("#text").toggleClass("flicker")},100);setTimeout(function(){clearInterval(c),$("#text").removeClass("flicker"),$("#header").text(""),$("#text").text(""),$(".help").addClass("hidden"),$("#splashscreen").addClass("hidden"),"undefined"!=typeof a&&a.call(b)},1100)},b.prototype.update=function(a){var b="Level : ",c=" | Depth : ";a.depth>a.highScore&&(a.highScore=a.depth),$("#menu_left").text(b+this.format(a.level,1)+c+this.format(5*a.depth,5)+"/"+this.format(5*a.goal,5)+"m"),$("#health_bar").width(String(a.shield)+"%"),a.bonus>0?($("#energy_bar").addClass("hidden"),$("#bonus_bar").width(String(a.bonus)+"%"),$("#bonus_bar").removeClass("hidden")):($("#bonus_bar").addClass("hidden"),$("#energy_bar").width(String(a.energy)+"%"),$("#energy_bar").removeClass("hidden"))},b.prototype.addHandler=function(a,b,c){var d=null;d=function(e){e.keyCode!==Phaser.Keyboard.CONTROL&&e.keyCode!==Phaser.Keyboard.ALT&&91!==e.keyCode&&(c&&a.off("click",d),$(document).off("keydown",d),b(e))}.bind(this),a.on("click",d),$(document).on("keydown",d)},b.prototype.format=function(a,b){var c=a,d="",e=0;for(e=b;e>0;e--){var f=Math.pow(10,e-1);d+=Math.floor(c/f),c-=Math.floor(c/f)*f}return d},a.Ui=b}(App),function(a){"use strict";var b,c=[],d=[];c[1]={pause:{path:"music/level1/",duration:45.176485260770974,next:{loop:1},reverse:!0},intro:{path:"music/level1/",duration:5.647074829931973,next:{verse1:1}},verse1:{path:"music/level1/",duration:39.529433106575965,next:{verse2:.8,ref:.2}},verse2:{path:"music/level1/",duration:39.529433106575965,next:{verse1:.2,ref:.8}},ref:{path:"music/level1/",duration:33.88235827664399,next:{verse2:.4,bridge:.6}},bridge:{path:"music/level1/",duration:33.88235827664399,next:{verse1:.4,verse2:.2,ref:.4}},starship:{path:"music/level1/",duration:16.941179138321996,next:{verse2:1}}},d[1]={drums0:{path:"music/level1/",duration:11.294126984126985,next:{drums1:1}},drums1:{path:"music/level1/",duration:5.647074829931973,next:{loop:.8,drums0:.2}},drums2:{path:"music/level1/",duration:11.294126984126985,next:{loop:.8,drums3:.2}},drums3:{path:"music/level1/",duration:11.294126984126985,next:{drums2:1}}},c[2]={pause:{path:"music/level2/",duration:45.176485260770974,next:{loop:1},reverse:!0},intro:{path:"music/level2/",duration:44.30770975056689,next:{verse1:1}},verse1:{path:"music/level2/",duration:22.153854875283447,next:{loop:.2,ref:.8}},ref:{path:"music/level2/",duration:29.538480725623582,next:{verse1:.3,bridge1:.6,bridge2:.2}},bridge1:{path:"music/level2/",duration:14.769251700680272,next:{verse1:.5,ref:.5}},bridge2:{path:"music/level2/",duration:44.30770975056689,next:{verse1:.5,ref:.5}},starship:{path:"music/level2/",duration:22.153854875283447,next:{verse1:1}}},d[2]={drums0:{path:"music/level2/",duration:7.384625850340136,next:{drums1:1}},drums1:{path:"music/level2/",duration:7.384625850340136,next:{loop:.8,drums0:.2}},drums2:{path:"music/level2/",duration:7.384625850340136,next:{loop:1}}},b=["hurt","die","arrow","hit","arrow","rupee","shield"];var e=function(a){this.context=a,this.loops=[],this.drums=[],this.sounds=[],this.extension="."+this.getAudioExtension(),this.muted=!1,this.master=this.context.createGain(),this.master.connect(this.context.destination),this.unlocked=!1,this.loading=!1,this.startTime=null,this.config={startDelay:.2,fadeInTime:.2,fadeOutTime:.1,masterGain:1},this.loadCount=0,this.level=1};e.prototype.mute=function(){0===this.master.gain.value?this.master.gain.value=1:this.master.gain.value=0},e.prototype.load=function(e,f){var g="",h=0,i=0;this.unlock();var j=function(a){"undefined"!=typeof a&&a==this.masterTrack&&a.play(),0===--this.loadCount&&f()}.bind(this);for(h=0,i=b.length;i>h;h++)this.loadCount++,g=b[h],this.sounds[g]=new a.Sound(this,g,j);this.drums[e]=[];for(g in d[e])this.loadCount++,this.drums[e][g]=new a.Track(this,this.drums[e],g,d[e][g],j);this.loops[e]=[];for(g in c[e])this.loadCount++,this.loops[e][g]=new a.Track(this,this.loops[e],g,c[e][g],j);1===e&&(this.masterTrack=this.loops[e].pause)},e.prototype.pause=function(a){this.stopTracks(),this.masterTrack=this.loops[this.level].pause,this.loops[this.level].pause.play(0,a)},e.prototype.play=function(a){this.stopTracks(),"undefined"!=typeof a&&(this.level=a),this.masterTrack=this.loops[this.level].intro,this.loops[this.level].intro.play(),this.drums[this.level].drums1.play(0,!1,null,this.loops[this.level].intro.endTime)},e.prototype.stop=function(){this.stopTracks()},e.prototype.reset=function(){this.level=1,this.play()},e.prototype.doubleTime=function(a){var b=a?this.drums[this.level].drums2:this.drums[this.level].drums1;for(var c in this.drums[this.level])c!==b.key&&this.drums[this.level][c].stop(.2);null!==this.loops[this.level].starship.startTime?b.play(0,!1,null,this.loops[this.level].starship.endTime):b.play(.2)},e.prototype.starship=function(a){var b=this.drums[this.level].drums1;for(var c in this.drums[this.level])(null===b.startTime||this.drums[this.level][c].startTime>b.startTime)&&(b=this.drums[this.level][c]);this.stopTracks(),this.masterTrack=this.loops[this.level].starship,this.loops[this.level].starship.play(0,!1,a),b.play(0,!1,null,this.loops[this.level].starship.endTime)},e.prototype.stopTracks=function(a){var b="";for(b in this.loops[this.level])this.loops[this.level][b].stop(a);for(b in this.drums[this.level])this.drums[this.level][b].stop(a)},e.prototype.createBufferSource=function(a){var b=this.context.createBufferSource();return b.buffer=a,b},e.prototype.loadAudio=function(a,b,c,d){var e=new XMLHttpRequest,f=b+c+this.extension;e.open("GET",f,!0),e.responseType="arraybuffer",e.onload=function(){a.decodeAudioData(e.response,function(a){return a?void d(a):void alert("Error decoding audio file "+f+".")})},e.onerror=function(){alert("Error loading audio file.")},e.send()},e.prototype.unlock=function(){if(!this.unlocked){this.unlocked=!0;var a=this.context.createBuffer(1,1,22050),b=this.createBufferSource(a);b.connect(this.master),b.start(0)}},e.prototype.canPlayAudio=function(a){var b=document.createElement("audio");return!(!b.canPlayType||!b.canPlayType("audio/"+a+";").replace(/no/,""))},e.prototype.getAudioExtension=function(){var a="wav";return this.canPlayAudio("ogg")?a="ogg":this.canPlayAudio("mp4")&&(a="m4a"),a},e.prototype.getBars=function(a){return Math.round((a-this.masterTrack.startTime)/this.drums[this.level].drums1.duration,4)},e.prototype.getReverseClone=function(a){var b=[],c=a.numberOfChannels,d=0;for(d=0;c>d;d++)b[d]=new Float32Array(a.getChannelData(d));var e=this.context.createBuffer(a.numberOfChannels,a.length,a.sampleRate);for(d=0;c>d;d++)e.getChannelData(d).set(b[d]);for(d=0;c>d;d++)Array.prototype.reverse.call(e.getChannelData(d));return e},a.Music=e}(App),function(a){"use strict";var b=function(a,b,c,d,e){this.music=a,this.tracks=b,this.key=c,this.path=d.path,this.duration=d.duration,this.loadReverse=d.reverse,this.nextMap=d.next,this.buffer=null,this.reverseBuffer=null,this.ready=!1,this.startTime=null,this.endTime=null,this.reverse=!1,this.deck=0,this.next=null,this.nodes=[{},{}],this.callback=null,this.muted=!1;var f=function(a){this.buffer=a,this.ready=!0,"undefined"!=typeof this.loadReverse&&this.loadReverse&&(this.reverseBuffer=this.music.getReverseClone(this.buffer)),e(this)}.bind(this);this.music.loadAudio(this.music.context,this.path,this.key,f)};b.prototype.play=function(a,b,c,d){if(null===this.startTime){this.callback=c;var e=0,f=0;"undefined"!=typeof d?(this.startTime=d,e=0):this.music.masterTrack.key===this.key?(this.startTime=this.music.context.currentTime+this.music.config.startDelay,e=0):(f=this.music.masterTrack.startTime,f>this.music.context.currentTime+this.music.config.startDelay/2?(this.startTime=f,e=0):(this.startTime=this.music.context.currentTime+this.music.config.startDelay,e=(this.startTime-f)%this.music.masterTrack.duration%this.duration)),"undefined"!=typeof b&&(this.reverse=b,b&&null===this.reverseBuffer&&(this.reverseBuffer=this.music.getReverseClone(this.buffer))),this.startDeck(this.startTime,e,a),this.scheduleNext()}},b.prototype.startDeck=function(a,b,c){0===this.deck?this.deck=1:this.deck=0;var d,e,f=0,g=this.music.masterTrack.startTime,h=this.music.masterTrack.duration;this.music.masterTrack.key===this.key||this.music.masterTrack.next==this.key?(d=0,e=0):(d=(a-g)%h%this.duration,e=0>d?-d:Math.min(h,this.duration)-d,1e-4>d||1e-4>e?(d=0,e=0):e>d||e>.5?e=0:d=0),null===this.startTime&&(this.startTime=a+e),this.endTime=a-d+this.duration+e;var i=this.buffer;this.reverse&&null!==this.reverseBuffer&&(i=this.reverseBuffer);var j=this.nodes[this.deck];j.source=this.music.createBufferSource(i),j.source.playbackRate.value=1,j.gain=this.music.context.createGain(),j.source.connect(j.gain),j.gain.connect(this.music.master),j.source.start(a+e,d),d>0?(f="undefined"!=typeof c?c:this.music.config.fadeInTime,j.gain.gain.linearRampToValueAtTime(0,a),j.gain.gain.linearRampToValueAtTime(1,a+Math.min(d,f))):j.gain.gain.value=this.muted?0:1,j.source.onended=this.onEnded.bind(this)},b.prototype.scheduleNext=function(){var a=Math.random();for(var b in this.nextMap){if(a<=this.nextMap[b]){"loop"===b?this.next=this.key:this.next=b;break}a-=this.nextMap[b]}this.tracks[this.next].startDeck(this.endTime)},b.prototype.onEnded=function(){this.next!==this.key&&(this.plays=0,this.startTime=null,this.endTime=null),this.music.masterTrack===this&&this.next!==this.key&&(this.music.masterTrack=this.tracks[this.next]),this.tracks[this.next].scheduleNext(),"undefined"!=typeof this.callback&&null!==this.callback&&(this.callback(),this.callback=null)},b.prototype.stop=function(a){this.plays=0,this.startTime=null,this.endTime=null;var b=this.music.config.fadeOutTime;"undefined"!=typeof a&&(b=a);for(var c=this.music.context.currentTime,d=0;2>d;d++)if("undefined"!=typeof this.nodes[d].source){this.nodes[d].source.onended=null,b>0&&this.nodes[d].gain.gain.value>0&&(this.nodes[d].gain.gain.linearRampToValueAtTime(1,c),this.nodes[d].gain.gain.linearRampToValueAtTime(0,c+b));try{this.nodes[d].source.stop(c+b)}catch(e){}}},b.prototype.mute=function(a){this.muted=a;for(var b=0;2>b;b++)"undefined"!=typeof this.nodes[b].gain&&this.nodes[b].gain.gain.linearRampToValueAtTime(a?0:1,this.music.context.currentTime+.01)},a.Track=b}(App),function(a){"use strict";var b=function(a,b,c){this.music=a,this.key=b,this.config={path:"sounds/",gain:.6,retriggerdelay:.1},this.buffer=null,this.ready=!1,this.startTime=null;var d=function(a){this.buffer=a,this.ready=!0,c()}.bind(this);a.loadAudio(this.music.context,this.config.path,this.key,d)};b.prototype.play=function(){var a=this.music.context.currentTime;if(null===this.startTime||a>this.startTime+this.config.retriggerdelay){this.startTime=a;var b={};b.source=this.music.createBufferSource(this.buffer),b.source.playbackRate.value=1,b.gain=this.music.context.createGain(),b.source.connect(b.gain),b.gain.connect(this.music.master),b.source.start(0),b.gain.gain.value=this.config.gain}},a.Sound=b}(App),function(a){"use strict";var b=function(a,b,c,d,e){this.width=d,this.height=e,this.game=c,this.ui=a,this.music=b,this.config=[],this.config[0]=[{autocorrelation:.9,lfo1period:100,lfo2period:100,gap:{width:4,stdev:.2},probability:{starship:0,bonus:0,health:.004,energy:.01},goal:{stage:200,level:1e3}},{autocorrelation:.9,lfo1period:100,lfo2period:50,gap:{width:2.75,stdev:.2},probability:{starship:0,bonus:.002,health:.006,energy:.03},goal:{stage:800,level:1e3}},{autocorrelation:.8,lfo1period:50,lfo2period:50,gap:{width:3,stdev:.2},probability:{starship:0,bonus:.002,health:.005,energy:.02},goal:{stage:1e3,level:1e3}}],this.config[1]=[{autocorrelation:.7,lfo1period:100,lfo2period:200,gap:{width:3,stdev:.5},probability:{starship:0,bonus:0,health:.007,energy:.02},goal:{stage:1200,level:2e3}},{autocorrelation:.6,lfo1period:40,lfo2period:60,gap:{width:3,stdev:.5},probability:{starship:0,bonus:.002,health:.005,energy:.02},goal:{stage:1500,level:2e3}},{autocorrelation:.6,lfo1period:100,lfo2period:125,gap:{width:3,stdev:.6},probability:{starship:.001,bonus:.002,health:.005,energy:.02},goal:{stage:2e3,level:2e3}}],this.config[2]=[{autocorrelation:1,lfo1period:0,lfo2period:0,gap:{width:100,stdev:0},probability:{starship:0,bonus:0,health:.004,energy:.01},goal:{stage:1e5,level:1e5}}]};b.prototype.init=function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.setMinMax(0,0,this.width,this.height),this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0},b.prototype.preload=function(){this.game.load.image("bullet","img/bullet.png"),this.game.load.spritesheet("earth","img/earth.png",50,50),this.game.load.image("playerLight","img/light_900x600.png"),this.game.load.spritesheet("ship","img/ship.png",40,27),this.game.load.spritesheet("kaboom","img/explosion.png",128,128),this.game.load.image("starfield","img/starfield.png",this.width,this.height),this.game.load.image("checker","img/checker.png",50,50)},b.prototype.create=function(){this.earth=new a.Earth(this.game,this.music,this.width,this.height,this.config[0][0]),this.bullets=this.game.add.group(),this.bullets.enableBody=!0,this.bullets.physicsBodyType=Phaser.Physics.ARCADE,this.bullets.createMultiple(30,"bullet"),this.bullets.setAll("anchor.x",.5),this.bullets.setAll("anchor.y",1),this.bullets.setAll("outOfBoundsKill",!0),this.bullets.setAll("checkWorldBounds",!0),this.bulletTime=0,this.player=new a.Player(this.game,this.ui,this.music,this.width),this.light={},this.light.texture=this.game.add.bitmapData(this.width,this.height),this.light.image=this.game.add.image(0,0,this.light.texture),this.light.image.blendMode=Phaser.blendModes.MULTIPLY,this.updateLight(),this.input.cursors=this.game.input.keyboard.createCursorKeys(),this.input.fireButton=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.input.pauseButton=this.game.input.keyboard.addKey(Phaser.Keyboard.P),this.input.pointer1=this.game.input.addPointer(),this.input.movement=0,this.input.isFiring=!1,this.input.ui=this.ui,this.input.update=function(){null!==this.ui.orientation?this.movement=this.ui.orientation:this.cursors.left.isDown?this.movement=-1:this.cursors.right.isDown?this.movement=1:this.movement=0,this.fireButton.isDown||this.pointer1.isDown?this.isFiring=!0:this.isFiring=!1},this.game.paused=!0,this.ui.loadScreen(this.play,this)},b.prototype.updateLight=function(){var a=400;this.light.texture.context.fillStyle="rgb(0, 0, 0)",this.light.texture.context.fillRect(0,0,this.width,this.height);var b=function(b){var c=this.light.texture.context.createRadialGradient(b.x,b.y,0,b.x,b.y,a);c.addColorStop(0,"rgba(255, 255, 255, 1.0)"),c.addColorStop(.1,"rgba(255, 255, 255, 1.0)"),c.addColorStop(.2,"rgba(255, 255, 255, 0.5)"),c.addColorStop(.3,"rgba(255, 255, 255, 0.25)"),c.addColorStop(.4,"rgba(255, 255, 255, 0.125)"),c.addColorStop(.5,"rgba(255, 255, 255, 0.0625)"),c.addColorStop(1,"rgba(255, 255, 255, 0.0)"),this.light.texture.context.beginPath(),this.light.texture.context.fillStyle=c,this.light.texture.context.arc(b.x,b.y,a,0,2*Math.PI),this.light.texture.context.fill()}.bind(this);this.player.sprite.alive?(this.light.texture.draw("playerLight",this.player.sprite.x-this.width/2,50),this.player.starship&&b(this.player.sprite)):b(this.player.sprite),this.bullets.forEachAlive(b),this.light.texture.dirty=!0},b.prototype.update=function(){var a=.2,b=20,c=40,d=0,e=this.config[this.player.level-1][this.player.stage-1];d=this.earth.update(this.player,this.config),this.player.update(d,e.goal.level),d==e.goal.stage&&(d==e.goal.level?this.player.level==this.config.length-1?this.ui.winScreen(this.restart,this):(this.game.paused=!0,this.player.stage=1,this.player.level+=1,this.ui.levelScreen(this.player.level,function(){this.game.paused=!1,this.music.play(this.player.level)},this)):this.player.stage+=1),this.updateLight(),this.input.update(),this.player.sprite.body.velocity.x+=this.input.movement*b;var f=a;Math.abs(this.player.sprite.body.velocity.x)>c&&(f*=f),this.player.sprite.body.velocity.x=Math.sign(this.player.sprite.body.velocity.x)*Math.floor((1-f)*Math.abs(this.player.sprite.body.velocity.x)),this.input.isFiring&&this.fireBullet(),this.player.sprite.x<3*this.player.sprite.width/2?(this.player.sprite.x=3*this.player.sprite.width/2,this.player.sprite.body.velocity.x=0):this.player.sprite.x>this.width-3*this.player.sprite.width/2&&(this.player.sprite.x=this.width-3*this.player.sprite.width/2,this.player.sprite.body.velocity.x=0),this.game.physics.arcade.overlap(this.bullets,this.earth.items,this.bulletHitsEarth,null,this),this.game.physics.arcade.overlap(this.earth.items,this.player.sprite,this.playerHitsEarth,null,this)},b.prototype.play=function(){this.game.paused=!1,this.music.play(),this.player.bonus>0&&this.music.doubleTime(!0),this.input.pauseButton.onDown.add(this.pause,this)},b.prototype.pause=function(){this.game.paused=!0,this.music.pause(),this.ui.pauseScreen(this.play,this),this.input.pauseButton.onDown.remove(this.pause,this)},b.prototype.restart=function(){this.earth.reset(this.config[0][0]),this.player.reset(),this.music.reset(),this.input.pauseButton.onDown.add(this.pause,this)},b.prototype.bulletHitsEarth=function(a,b){b.frame<this.earth.frames.HEALTH&&(a.kill(),this.earth.explode(b),this.earth.kill(b))},b.prototype.playerHitsEarth=function(a,b){b.frame>=this.earth.frames.HEALTH?(this.playerHitsGoodie(b),this.earth.kill(b)):(this.earth.kill(b),this.earth.explode(b),this.player.starship||this.playerTakesHit(b))},b.prototype.fireBullet=function(){if(this.player.sprite.alive&&this.game.time.now>this.bulletTime&&(this.player.energy>0||this.player.bonus>0)){var a=this.bullets.getFirstExists(!1);a&&(this.player.bonus>0?(a.reset(this.player.sprite.x-22,this.player.sprite.y+30),a.body.velocity.y=400,a.body.velocity.x=this.player.sprite.body.velocity.x/2,this.bulletTime=this.game.time.now+200,a=this.bullets.getFirstExists(!1),a.reset(this.player.sprite.x+22,this.player.sprite.y+30),a.body.velocity.y=400,a.body.velocity.x=this.player.sprite.body.velocity.x/2,this.bulletTime=this.game.time.now+200,this.music.sounds.arrow.play()):(a.reset(this.player.sprite.x,this.player.sprite.y+30),a.body.velocity.y=400,a.body.velocity.x=this.player.sprite.body.velocity.x/2,this.bulletTime=this.game.time.now+200,this.music.sounds.arrow.play(),this.player.energy-=10))}},b.prototype.playerHitsGoodie=function(a){a.frame===this.earth.frames.HEALTH?this.player.shield+=Math.min(20,100-this.player.shield):a.frame===this.earth.frames.ENERGY?this.player.energy+=Math.min(20,100-this.player.energy):a.frame===this.earth.frames.BONUS?(0===this.player.bonus&&this.music.doubleTime(!0),this.player.bonus=100):a.frame===this.earth.frames.STARSHIP&&(this.player.starship=!0,this.music.starship(function(){this.player.starship=!1,this.player.sprite.frame=0}.bind(this))),this.music.sounds.rupee.play(),this.ui.update(this.player)},b.prototype.playerTakesHit=function(a){this.player.shield-=10,this.ui.update(this.player),this.music.sounds.hurt.play(),this.player.shield<=0&&(this.player.sprite.kill(),this.music.sounds.die.play(),this.music.pause(!0),this.ui.gameOverScreen(this.restart,this),this.input.pauseButton.onDown.remove(this.pause,this))},a.GameState=b}(App),function(a){"use strict";var b=function(a,b,c,d){this.game=a,this.ui=b,this.music=c,this.width=d,this.highScore=0,this.starship=!1,this.sprite=this.game.add.sprite(this.width/2,80,"ship"),this.sprite.anchor.setTo(.5,.5),this.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.reset()};b.prototype.reset=function(){this.stage=1,this.level=1,this.depth=-1,this.goal=0,this.shield=100,this.energy=100,this.bonus=0,this.starship=!1,this.sprite.revive(),this.sprite.x=this.width/2},b.prototype.update=function(a,b){a!==this.depth&&(this.depth=a,this.goal=b,this.energy<100&&(this.energy+=1),this.bonus>0&&(this.bonus-=1,0===this.bonus&&this.music.doubleTime(!1)),this.starship&&(a%2===0?this.sprite.frame=1:this.sprite.frame=2),this.sprite.alive&&this.ui.update(this))},a.Player=b}(App),function(a){"use strict";var b=function(a,b,c,d,e){this.game=a,this.music=b,this.width=c,this.height=d,this.backgroundScroll=0,this.levelHeight=50,this.blockWidth=50,this.depth=0,this.frames={HEALTH:16,ENERGY:17,BONUS:18,STARSHIP:19},this.nBlocks=this.width/this.blockWidth,this.nLevels=Math.floor(this.height/this.levelHeight),this.blockfield=this.game.add.tileSprite(0,0,this.width,this.height,"earth");var f,g;for(this.background=this.game.add.group(),this.background.enableBody=!0,this.background.physicsBodyType=Phaser.Physics.ARCADE,g=0;g<2*this.nLevels+4;g++)f=new Phaser.TileSprite(this.game,0,0,this.blockWidth,this.levelHeight,"starfield"),this.background.add(f);for(this.checkers=this.game.add.group(),this.checkers.enableBody=!0,this.checkers.physicsBodyType=Phaser.Physics.ARCADE,g=0;8>g;g++)f=new Phaser.TileSprite(this.game,0,0,this.blockWidth,this.levelHeight,"checker"),this.checkers.add(f);this.items=this.game.add.group(),this.items.enableBody=!0,this.items.physicsBodyType=Phaser.Physics.ARCADE,this.items.createMultiple(6*(this.nLevels+4),"earth"),this.lastRow=[],this.previousRow=[],this.explosions=this.game.add.group(),this.explosions.createMultiple(30,"kaboom");var h=function(a){a.anchor.x=.5,a.anchor.y=.5,a.animations.add("kaboom")};this.explosions.forEach(h,this),this.reset(e)};b.prototype.reset=function(a){this.items.y=0,this.background.y=0,this.checkers.y=0,this.explosions.y=0;for(var b=0;b<this.nBlocks;b++)this.lastRow[b]=null;this.random=.5,this.lfo=.5,this.items.forEach(this.kill,this),this.items.callAll("kill"),this.background.callAll("kill"),this.checkers.callAll("kill");var c=this.background.next();c.reset(0,0),c.width=this.width,c.height=this.height,this.updateConfig(a),this.step(0)},b.prototype.kill=function(a,b){var c=a.cell;"undefined"!=typeof c&&null!==c&&(this.isBlock(c)&&(b||"undefined"==typeof b)?(c.frame=null,c.item=null,this.updateFrame(c.neighbors.left),this.updateFrame(c.neighbors.right),this.updateFrame(c.neighbors.top),this.updateFrame(c.neighbors.bottom)):(c.frame=null,c.item=null)),a.kill(),a.anchor.setTo(0,0),a.body.moves=!1,a.frame=0,a.width=this.blockWidth,a.cell=null,a.background=null},b.prototype.updateFrame=function(a){var b=0;null!==a&&(this.isBlock(a)&&(this.isBlock(a.neighbors.left)||(b+=1),this.isBlock(a.neighbors.bottom)||(b+=2),this.isBlock(a.neighbors.right)||(b+=4),this.isBlock(a.neighbors.top)||(b+=8),a.frame=b,null!==a.item&&(a.item.frame=b)),null===a.item&&this.createItem(a))},b.prototype.createItem=function(a){var b=null,c=a.j*this.blockWidth,d=this.height+a.l*this.levelHeight;null===a.item&&(null===a.item&&a.frame>0&&(b=this.items.getFirstExists(!1),b.reset(c,d),b.frame=a.frame,a.item=b,b.cell=a),(null===a.frame||a.frame>0)&&this.createBackground(a,c,d))},b.prototype.createBackground=function(a,b,c){var d=null,e=null;0===a.frame||this.hasBackground(a)||(this.hasBackground(a.neighbors.left)?(d=a.neighbors.left.background,d.width+=this.blockWidth,this.hasChecker(a.neighbors.left)&&(e=a.neighbors.left.checker,e.width+=this.blockWidth)):this.hasBackground(a.neighbors.right)?(d=a.neighbors.right.background,d.x-=this.blockWidth,d.tilePosition.x=-b,d.width+=this.blockWidth,this.hasChecker(a.neighbors.right)&&(e=a.neighbors.right.checker,e.x-=this.blockWidth,e.width+=this.blockWidth)):(d=this.background.next(),d.reset(b,c),d.tilePosition.x=-b,d.tilePosition.y=-c+this.backgroundScroll,d.width=this.blockWidth,d.height=this.levelHeight,a.l==this.config.goal.level&&(e=this.checkers.next(),e.reset(b,c),e.width=this.blockWidth,e.height=this.levelHeight)),a.background=d,null!==e&&(a.checker=e))},b.prototype.updateConfig=function(a){this.config=a,this.autocorrelation=a.autocorrelation,this.lfo1period=a.lfo1period,this.lfo2period=a.lfo2period},b.prototype.update=function(a,b){var c=4,d=0;a.sprite.alive||(c=1),this.items.y-=c,this.background.y-=c,this.checkers.y-=c,this.explosions.y-=c,this.blockfield.tilePosition.y=this.items.y%this.levelHeight,this.backgroundScroll=Math.floor(this.items.y/8);var e=function(a){a.tilePosition.y=-a.y+this.backgroundScroll}.bind(this);return this.background.forEach(e),d=Math.floor(-this.items.y/this.levelHeight)+1,d>this.depth&&(this.step(d),d>this.config.goal.stage&&(d>this.config.goal.level?this.updateConfig(b[a.level][0]):this.updateConfig(b[a.level-1][a.stage]))),Math.max(0,d-this.nLevels)},b.prototype.step=function(a){var b=0,c=0,d=0,e=0,f=0,g=null,h=null,i=null;for(this.depth=a,this.random=(1-this.autocorrelation)*Math.random()+this.autocorrelation*this.random,c=(Math.sin(2*a*Math.PI/this.lfo1period)+1)/2,d=(Math.sin(2*a*Math.PI/this.lfo2period)+1)/2,e=(c/3+d/3+this.random/3)*(this.nBlocks-4)+2,f=Math.round(this.config.gap.width*(1+this.config.gap.stdev*(2*Math.random()-1))),this.previousRow=this.lastRow,this.lastRow=new Array(this.nBlocks),b=0;b<this.nBlocks;b++){if(g=null,h=null,b<Math.max(1,e-f/2)||b>Math.min(this.nBlocks-2,e+f/2))h=0;else{var j=Math.random();j<this.config.probability.starship?h=this.frames.STARSHIP:j<this.config.probability.bonus?h=this.frames.BONUS:j<this.config.probability.health?h=this.frames.HEALTH:j<this.config.probability.energy&&(h=this.frames.ENERGY)}g={item:null,j:b,l:a,frame:h,neighbors:{top:null,left:null,right:null,bottom:null}},this.lastRow[b]=g}for(b=0;b<this.nBlocks;b++)null!==this.lastRow[b]&&(this.lastRow[b].neighbors.left=this.lastRow[((b-1)%this.nBlocks+this.nBlocks)%this.nBlocks],this.lastRow[b].neighbors.right=this.lastRow[(b+1)%this.nBlocks],this.lastRow[b].neighbors.top=this.previousRow[b]),null!==this.previousRow[b]&&(this.previousRow[b].neighbors.bottom=this.lastRow[b]);if(0!==a){for(b=0;b<this.nBlocks;b++)this.updateFrame(this.previousRow[b]);i=function(a){null!==a&&null!==a.body&&a.body.y<0&&this.kill(a,!1)}.bind(this),this.items.forEachAlive(i,this)}},b.prototype.isBlock=function(a){return null!==a&&null!==a.frame&&a.frame<this.frames.HEALTH},b.prototype.hasBackground=function(a){return"undefined"!=typeof a.background&&null!==a.background},b.prototype.hasChecker=function(a){return"undefined"!=typeof a.checker&&null!==a.checker},b.prototype.explode=function(a){this.music.sounds.hit.play();var b=this.explosions.getFirstExists(!1);b&&(b.reset(a.body.x+a.body.width/2,-this.items.y+a.body.y+a.body.height/2),b.play("kaboom",30,!1,!0))},a.Earth=b}(App);