var App=function(){"use strict";return{}}();$(function(){var a=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;if(a){var b=new a,c=new App.Music(b),d=new App.Ui(c),e=new Phaser.Game(900,600,Phaser.AUTO,"canvas_container"),f=new App.GameState(d,c,e,900,600);e.state.add("game",f,!0)}else $("#loader").addClass("hidden"),$("#header").text("ERROR"),$("#text").text("This game requires a browser which supports WebAudio.")}),function(a){"use strict";var b=function(a){this.music=a,this.levelString="Level : ",this.highScoreString=" | High score : ",this.touch=!1,this.orientation=null;var b=function(a){var b=null;a.beta>30?b=a.gamma:a.gamma<-30?b=a.beta:a.gamma>30&&(b=-a.beta),null!==b&&(this.orientation=Math.max(Math.min(b/20,1),-1))}.bind(this);window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",b);var c=null;c=function(){$("#splashscreen").unbind("touchend",c),this.touch=!0}.bind(this),$("#splashscreen").bind("touchend",c)};b.prototype.loadScreen=function(a,b){var c=function(c){if(c.preventDefault(),c.stopPropagation(),$("#player").hasClass("fullscreen")){$("#player").removeClass("fullscreen"),$(".help").removeClass("hidden"),null===this.orientation?$(".deviceorientation-on").addClass("hidden"):$(".deviceorientation-off").addClass("hidden"),this.showSplashScreen("","Loading audio");var d=function(){$("#player_pause").removeClass("hidden"),this.startScreen(a,b)}.bind(this);this.music.load(d)}else this.music.mute(),$(".playerbutton").toggleClass("hidden")}.bind(this);this.addHandler($("#player"),c,!1),$("#splashscreen").addClass("hidden"),$("#player").removeClass("hidden")},b.prototype.startScreen=function(a,b){$("#loader").addClass("hidden"),this.showSplashScreen("","Press any key to start your mission."),this.setSplashScreenHandler(a,b)},b.prototype.pauseScreen=function(a,b){this.showSplashScreen("Paused","Press any key to continue."),this.setSplashScreenHandler(a,b)},b.prototype.gameOverScreen=function(a,b){this.showSplashScreen("GAME OVER","");var c=function(){this.showSplashScreen("GAME OVER","Press any key to restart"),this.setSplashScreenHandler(a,b)}.bind(this);setTimeout(c,3e3)},b.prototype.showSplashScreen=function(a,b){$("#header").text(a),$("#text").text(b),$("#splashscreen").removeClass("hidden")},b.prototype.setSplashScreenHandler=function(a,b){var c=function(){this.hideSplashScreen(a,b)}.bind(this);this.addHandler($("#splashscreen"),c,!0)},b.prototype.hideSplashScreen=function(a,b){var c=setInterval(function(){$("#text").toggleClass("flicker")},100);setTimeout(function(){clearInterval(c),$("#text").removeClass("flicker"),$("#header").text(""),$("#text").text(""),$(".help").addClass("hidden"),$("#splashscreen").addClass("hidden"),"undefined"!=typeof a&&a.call(b)},1100)},b.prototype.update=function(a){a.level>a.highScore&&(a.highScore=a.level),$("#menu_left").text(this.levelString+this.format(a.level,5)+this.highScoreString+this.format(a.highScore,5)),$("#health_bar").width(String(a.shield)+"%"),a.bonus>0?($("#energy_bar").addClass("hidden"),$("#bonus_bar").width(String(a.bonus)+"%"),$("#bonus_bar").removeClass("hidden")):($("#bonus_bar").addClass("hidden"),$("#energy_bar").width(String(a.energy)+"%"),$("#energy_bar").removeClass("hidden"))},b.prototype.addHandler=function(a,b,c){var d=null;d=function(e){e.keyCode!==Phaser.Keyboard.CONTROL&&e.keyCode!==Phaser.Keyboard.ALT&&91!==e.keyCode&&(c&&a.off("click",d),$(document).off("keydown",d),b(e))}.bind(this),a.on("click",d),$(document).on("keydown",d)},b.prototype.format=function(a,b){var c=a,d="",e=0;for(e=b;e>0;e--){var f=Math.pow(10,e-1);d+=Math.floor(c/f),c-=Math.floor(c/f)*f}return d},a.Ui=b}(App),function(a){"use strict";var b=function(a){this.context=a,this.sounds={},this.tracks={},this.onLoad=null,this.extension="."+this.getAudioExtension(),this.muted=!1,this.master=this.context.createGain(),this.master.connect(this.context.destination),this.unlocked=!1,this.loading=!1,this.startTime=null,this.config={startDelay:.2,fadeInTime:.2,fadeOutTime:.1,masterGain:1}};b.prototype.mute=function(){0===this.master.gain.value?this.master.gain.value=1:this.master.gain.value=0},b.prototype.load=function(b){this.onLoad=b,this.unlock(),this.sounds.hurt=new a.Sound(this,"hurt"),this.sounds.die=new a.Sound(this,"die"),this.sounds.arrow=new a.Sound(this,"arrow"),this.sounds.hit=new a.Sound(this,"hit"),this.sounds.rupee=new a.Sound(this,"rupee"),this.sounds.shield=new a.Sound(this,"shield"),this.tracks.pause=new a.Track(this,"pause",45.176485260770974,{loop:1},!0),this.tracks.loop1=new a.Track(this,"loop1",39.529433106575965,{loop:.2,loop2:.8}),this.tracks.loop2=new a.Track(this,"loop2",33.88235827664399,{loop:.2,loop1:.8}),this.tracks.drums0=new a.Track(this,"drums0",11.294126984126985,{drums1:1}),this.tracks.drums1=new a.Track(this,"drums1",5.647074829931973,{loop:.8,drums0:.2}),this.tracks.drums2=new a.Track(this,"drums2",11.294126984126985,{loop:.8,drums3:.2}),this.tracks.drums3=new a.Track(this,"drums3",11.294126984126985,{drums2:1}),this.masterTrack=this.tracks.pause},b.prototype.unlock=function(){if(!this.unlocked){this.unlocked=!0;var a=this.context.createBuffer(1,1,22050),b=this.createBufferSource(a);b.connect(this.master),b.start(0)}},b.prototype.ready=function(){var a=null;for(a in this.tracks)if(!this.tracks[a].ready)return!1;for(a in this.sounds)if(!this.sounds[a].ready)return!1;return null!==this.onLoad&&this.onLoad(),!0},b.prototype.pause=function(a){this.stopTracks(),this.masterTrack=this.tracks.pause,this.tracks.pause.play(0,a)},b.prototype.play=function(){this.stopTracks(),this.masterTrack=this.tracks.loop1,this.tracks.loop1.play(),this.tracks.drums1.play()},b.prototype.stop=function(){this.stopTracks()},b.prototype.halfTime=function(){this.tracks.drums0.stop(.2),this.tracks.drums1.play(.5),this.tracks.drums2.stop(.5),this.tracks.drums3.stop(.2)},b.prototype.doubleTime=function(){this.tracks.drums0.stop(.2),this.tracks.drums1.stop(.2),this.tracks.drums2.play(.2),this.tracks.drums3.stop(.2)},b.prototype.createBufferSource=function(a){var b=this.context.createBufferSource();return b.buffer=a,b},b.prototype.loadAudio=function(a,b,c,d){var e=new XMLHttpRequest,f=b+c+this.extension;e.open("GET",f,!0),e.responseType="arraybuffer",e.onload=function(){a.decodeAudioData(e.response,function(a){return a?void d(a):void alert("Error decoding audio file "+f+".")})},e.onerror=function(){alert("Error loading audio file.")},e.send()},b.prototype.stopTracks=function(a){for(var b in this.tracks)this.tracks[b].stop(a)},b.prototype.canPlayAudio=function(a){var b=document.createElement("audio");return!(!b.canPlayType||!b.canPlayType("audio/"+a+";").replace(/no/,""))},b.prototype.getAudioExtension=function(){var a="wav";return this.canPlayAudio("ogg")?a="ogg":this.canPlayAudio("mp4")&&(a="m4a"),a},b.prototype.getBars=function(a){return Math.round((a-this.masterTrack.startTime)/this.tracks.drums1.duration,4)},b.prototype.getReverseClone=function(a){var b=[],c=a.numberOfChannels,d=0;for(d=0;c>d;d++)b[d]=new Float32Array(a.getChannelData(d));var e=this.context.createBuffer(a.numberOfChannels,a.length,a.sampleRate);for(d=0;c>d;d++)e.getChannelData(d).set(b[d]);for(d=0;c>d;d++)Array.prototype.reverse.call(e.getChannelData(d));return e},a.Music=b}(App),function(a){"use strict";var b=function(a,b,c,d,e){this.music=a,this.key=b,this.config={path:"music/"},this.buffer=null,this.reverseBuffer=null,this.ready=!1,this.duration=c,this.startTime=null,this.endTime=null,this.loadReverse=e,this.reverse=!1,this.deck=0,this.nextMap=d,this.next=null,this.nodes=[{},{}];var f=function(a){this.buffer=a,this.ready=!0,"undefined"!=typeof this.loadReverse&&this.loadReverse&&(this.reverseBuffer=this.music.getReverseClone(this.buffer)),this.music.ready(),this.music.masterTrack===this&&this.play()}.bind(this);this.music.loadAudio(this.music.context,this.config.path,this.key,f)};b.prototype.play=function(a,b){if(null===this.startTime){var c=0,d=0;this.music.masterTrack.key===this.key?(this.startTime=this.music.context.currentTime+this.music.config.startDelay,c=0):(d=this.music.masterTrack.startTime,d>this.music.context.currentTime+this.music.config.startDelay/2?(this.startTime=d,c=0):(this.startTime=this.music.context.currentTime+this.music.config.startDelay,c=(this.startTime-d)%this.music.masterTrack.duration%this.duration)),"undefined"!=typeof b&&(this.reverse=b,b&&null===this.reverseBuffer&&(this.reverseBuffer=this.music.getReverseClone(this.buffer))),this.startDeck(this.startTime,c,a),this.scheduleNext()}},b.prototype.startDeck=function(a,b,c){0===this.deck?this.deck=1:this.deck=0;var d,e,f=0;"undefined"!=typeof b?(d=b,e=0):(d=0,e=0),null===this.startTime&&(this.startTime=a+e),this.endTime=a-d+this.duration+e;var g=this.buffer;this.reverse&&null!==this.reverseBuffer&&(g=this.reverseBuffer);var h=this.nodes[this.deck];h.source=this.music.createBufferSource(g),h.source.playbackRate.value=1,h.gain=this.music.context.createGain(),h.source.connect(h.gain),h.gain.connect(this.music.master),h.source.start(a+e,d),d>0?(f="undefined"!=typeof c?c:this.music.config.fadeInTime,h.gain.gain.linearRampToValueAtTime(0,a),h.gain.gain.linearRampToValueAtTime(1,a+Math.min(d,f))):h.gain.gain.value=1,h.source.onended=this.onEnded.bind(this)},b.prototype.scheduleNext=function(){var a=Math.random();for(var b in this.nextMap){if(a<=this.nextMap[b]){"loop"===b?this.next=this.key:this.next=b;break}a-=this.nextMap[b]}this.music.tracks[this.next].startDeck(this.endTime)},b.prototype.onEnded=function(){this.next!==this.key&&(this.plays=0,this.startTime=null,this.endTime=null),this.music.masterTrack===this&&this.next!==this.key&&(this.music.masterTrack=this.music.tracks[this.next]),this.music.tracks[this.next].scheduleNext()},b.prototype.stop=function(a){this.plays=0,this.startTime=null,this.endTime=null;var b=this.music.config.fadeOutTime;"undefined"!=typeof a&&(b=a);for(var c=0;2>c;c++)if("undefined"!=typeof this.nodes[c].source){this.nodes[c].source.onended=null,this.music.config.fadeOutTime>0&&this.nodes[c].gain.gain.linearRampToValueAtTime(0,this.music.context.currentTime+this.music.config.fadeOutTime);try{this.nodes[c].source.stop(this.music.context.currentTime+b)}catch(d){}}},a.Track=b}(App),function(a){"use strict";var b=function(a,b){this.music=a,this.key=b,this.config={path:"sounds/",gain:.6,retriggerdelay:.1},this.buffer=null,this.ready=!1,this.startTime=null;var c=function(a){this.buffer=a,this.ready=!0,this.music.ready()}.bind(this);a.loadAudio(this.music.context,this.config.path,this.key,c)};b.prototype.play=function(){var a=this.music.context.currentTime;if(null===this.startTime||a>this.startTime+this.config.retriggerdelay){this.startTime=a;var b={};b.source=this.music.createBufferSource(this.buffer),b.source.playbackRate.value=1,b.gain=this.music.context.createGain(),b.source.connect(b.gain),b.gain.connect(this.music.master),b.source.start(0),b.gain.gain.value=this.config.gain}},a.Sound=b}(App),function(a){"use strict";var b=function(a,b,c,d,e){this.width=d,this.height=e,this.game=c,this.ui=a,this.music=b,this.sounds=b.sounds};b.prototype.init=function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.setMinMax(0,0,this.width,this.height),this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0},b.prototype.preload=function(){this.game.load.image("bullet","img/bullet.png"),this.game.load.spritesheet("earth","img/earth.png",50,50),this.game.load.image("playerLight","img/light_900x600.png"),this.game.load.image("ship","img/ship.png"),this.game.load.spritesheet("kaboom","img/explosion.png",128,128),this.game.load.image("starfield","img/starfield.png",this.width,this.height)},b.prototype.create=function(){this.earth=new a.Earth(this.game,this.sounds,this.width,this.height),this.bullets=this.game.add.group(),this.bullets.enableBody=!0,this.bullets.physicsBodyType=Phaser.Physics.ARCADE,this.bullets.createMultiple(30,"bullet"),this.bullets.setAll("anchor.x",.5),this.bullets.setAll("anchor.y",1),this.bullets.setAll("outOfBoundsKill",!0),this.bullets.setAll("checkWorldBounds",!0),this.bulletTime=0,this.player=new a.Player(this.game,this.ui,this.music,this.width),this.light={},this.light.texture=this.game.add.bitmapData(this.width,this.height),this.light.image=this.game.add.image(0,0,this.light.texture),this.light.image.blendMode=Phaser.blendModes.MULTIPLY,this.updateLight(),this.input.cursors=this.game.input.keyboard.createCursorKeys(),this.input.fireButton=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.input.pauseButton=this.game.input.keyboard.addKey(Phaser.Keyboard.P),this.input.pointer1=this.game.input.addPointer(),this.input.movement=0,this.input.isFiring=!1,this.input.ui=this.ui,this.input.update=function(){null!==this.ui.orientation?this.movement=this.ui.orientation:this.cursors.left.isDown?this.movement=-1:this.cursors.right.isDown?this.movement=1:this.movement=0,this.fireButton.isDown||this.pointer1.isDown?this.isFiring=!0:this.isFiring=!1},this.game.paused=!0,this.ui.loadScreen(this.play,this)},b.prototype.updateLight=function(){var a=400;this.light.texture.context.fillStyle="rgb(0, 0, 0)",this.light.texture.context.fillRect(0,0,this.width,this.height);var b=function(b){var c=this.light.texture.context.createRadialGradient(b.x,b.y,0,b.x,b.y,a);c.addColorStop(0,"rgba(255, 255, 255, 1.0)"),c.addColorStop(.1,"rgba(255, 255, 255, 1.0)"),c.addColorStop(.2,"rgba(255, 255, 255, 0.5)"),c.addColorStop(.3,"rgba(255, 255, 255, 0.25)"),c.addColorStop(.4,"rgba(255, 255, 255, 0.125)"),c.addColorStop(.5,"rgba(255, 255, 255, 0.0625)"),c.addColorStop(1,"rgba(255, 255, 255, 0.0)"),this.light.texture.context.beginPath(),this.light.texture.context.fillStyle=c,this.light.texture.context.arc(b.x,b.y,a,0,2*Math.PI),this.light.texture.context.fill()}.bind(this);this.player.sprite.alive?this.light.texture.draw("playerLight",this.player.sprite.x-this.width/2,50):b(this.player.sprite),this.bullets.forEachAlive(b),this.light.texture.dirty=!0},b.prototype.update=function(){var a=.2,b=20,c=40;this.earth.update(this.player),this.updateLight(),this.input.update(),this.player.sprite.body.velocity.x+=this.input.movement*b;var d=a;Math.abs(this.player.sprite.body.velocity.x)>c&&(d*=d),this.player.sprite.body.velocity.x=Math.sign(this.player.sprite.body.velocity.x)*Math.floor((1-d)*Math.abs(this.player.sprite.body.velocity.x)),this.input.isFiring&&this.fireBullet(),this.player.sprite.x<3*this.player.sprite.width/2?(this.player.sprite.x=3*this.player.sprite.width/2,this.player.sprite.body.velocity.x=0):this.player.sprite.x>this.width-3*this.player.sprite.width/2&&(this.player.sprite.x=this.width-3*this.player.sprite.width/2,this.player.sprite.body.velocity.x=0),this.game.physics.arcade.overlap(this.bullets,this.earth.items,this.bulletHitsEarth,null,this),this.game.physics.arcade.overlap(this.earth.items,this.player.sprite,this.playerHitsEarth,null,this)},b.prototype.play=function(){this.game.paused=!1,this.music.play(),this.player.bonus>0&&this.music.doubleTime(),this.input.pauseButton.onDown.add(this.pause,this)},b.prototype.pause=function(){this.game.paused=!0,this.music.pause(),this.ui.pauseScreen(this.play,this),this.input.pauseButton.onDown.remove(this.pause,this)},b.prototype.restart=function(){this.earth.reset(),this.player.reset(),this.music.play(),this.input.pauseButton.onDown.add(this.pause,this)},b.prototype.bulletHitsEarth=function(a,b){b.frame<this.earth.frames.HEALTH&&(a.kill(),this.earth.explode(b),this.earth.kill(b))},b.prototype.playerHitsEarth=function(a,b){b.frame>=this.earth.frames.HEALTH?(this.playerHitsGoodie(b),this.earth.kill(b)):(this.earth.kill(b),this.playerTakesHit(b))},b.prototype.fireBullet=function(){if(this.player.sprite.alive&&this.game.time.now>this.bulletTime&&(this.player.energy>0||this.player.bonus>0)){var a=this.bullets.getFirstExists(!1);a&&(this.player.bonus>0?(a.reset(this.player.sprite.x-22,this.player.sprite.y+30),a.body.velocity.y=400,a.body.velocity.x=this.player.sprite.body.velocity.x/2,this.bulletTime=this.game.time.now+200,a=this.bullets.getFirstExists(!1),a.reset(this.player.sprite.x+22,this.player.sprite.y+30),a.body.velocity.y=400,a.body.velocity.x=this.player.sprite.body.velocity.x/2,this.bulletTime=this.game.time.now+200,this.sounds.arrow.play()):(a.reset(this.player.sprite.x,this.player.sprite.y+30),a.body.velocity.y=400,a.body.velocity.x=this.player.sprite.body.velocity.x/2,this.bulletTime=this.game.time.now+200,this.sounds.arrow.play(),this.player.energy-=10))}},b.prototype.playerHitsGoodie=function(a){a.frame===this.earth.frames.HEALTH?this.player.shield+=Math.min(20,100-this.player.shield):a.frame===this.earth.frames.ENERGY?this.player.energy+=Math.min(20,100-this.player.energy):a.frame===this.earth.frames.BONUS&&(this.music.doubleTime(),this.player.bonus=100),this.sounds.rupee.play(),this.ui.update(this.player)},b.prototype.playerTakesHit=function(a){this.player.shield-=10,this.ui.update(this.player),this.sounds.hurt.play(),this.earth.explode(a),this.player.shield<=0&&(this.player.sprite.kill(),this.sounds.die.play(),this.music.pause(!0),this.ui.gameOverScreen(this.restart,this),this.input.pauseButton.onDown.remove(this.pause,this))},a.GameState=b}(App),function(a){"use strict";var b=function(a,b,c,d){this.game=a,this.ui=b,this.music=c,this.width=d,this.level=0,this.highScore=0,this.shield=100,this.energy=100,this.bonus=0,this.sprite=this.game.add.sprite(this.width/2,80,"ship"),this.sprite.anchor.setTo(.5,.5),this.game.physics.enable(this.sprite,Phaser.Physics.ARCADE)};b.prototype.reset=function(){this.level=-1,this.shield=100,this.energy=100,this.bonus=0,this.sprite.revive(),this.sprite.x=this.width/2},b.prototype.updateLevel=function(a){this.level=a,this.energy<100&&(this.energy+=1),this.bonus>0&&(this.bonus-=1,0===this.bonus&&this.music.halfTime()),this.sprite.alive&&this.ui.update(this)},a.Player=b}(App),function(a){"use strict";var b=function(a,b,c,d){this.game=a,this.sounds=b,this.width=c,this.height=d,this.backgroundScroll=0,this.config={autocorrelation:.8,decay:.999,levelHeight:50,blockWidth:50,lfo1period:100,lfo2period:450},this.frames={HEALTH:16,ENERGY:17,BONUS:18},this.nBlocks=this.width/this.config.blockWidth,this.nLevels=Math.floor(this.height/this.config.levelHeight),this.blockfield=this.game.add.tileSprite(0,0,this.width,this.height,"earth"),this.background=this.game.add.group(),this.background.enableBody=!0,this.background.physicsBodyType=Phaser.Physics.ARCADE;for(var e,f=0;f<2*this.nLevels+4;f++)e=new Phaser.TileSprite(this.game,0,0,this.config.blockWidth,this.config.levelHeight,"starfield"),this.background.add(e);this.items=this.game.add.group(),this.items.enableBody=!0,this.items.physicsBodyType=Phaser.Physics.ARCADE,this.items.createMultiple(6*(this.nLevels+4),"earth"),this.lastRow=[],this.previousRow=[],this.explosions=this.game.add.group(),this.explosions.createMultiple(30,"kaboom");var g=function(a){a.anchor.x=.5,a.anchor.y=.5,a.animations.add("kaboom")};this.explosions.forEach(g,this),this.reset()};b.prototype.reset=function(){this.items.y=0,this.background.y=0,this.explosions.y=0;for(var a=0;a<this.nBlocks;a++)this.lastRow[a]=null;this.autocorrelation=this.config.autocorrelation,this.lfo1period=this.config.lfo1period,this.lfo2period=this.config.lfo2period,this.random=.5,this.lfo=.5,this.items.forEach(this.kill,this),this.items.callAll("kill"),this.background.callAll("kill");var b=this.background.next();b.reset(0,0),b.width=this.width,b.height=this.height,this.updateLevel(0)},b.prototype.kill=function(a,b){var c=a.cell;"undefined"!=typeof c&&null!==c&&(this.isBlock(c)&&(b||"undefined"==typeof b)?(c.frame=null,c.item=null,this.updateFrame(c.neighbors.left),this.updateFrame(c.neighbors.right),this.updateFrame(c.neighbors.top),this.updateFrame(c.neighbors.bottom)):(c.frame=null,c.item=null)),a.kill(),a.anchor.setTo(0,0),a.body.moves=!1,a.frame=0,a.width=this.config.blockWidth,a.cell=null,a.background=null},b.prototype.updateFrame=function(a){var b=0;null!==a&&(this.isBlock(a)&&(this.isBlock(a.neighbors.left)||(b+=1),this.isBlock(a.neighbors.bottom)||(b+=2),this.isBlock(a.neighbors.right)||(b+=4),this.isBlock(a.neighbors.top)||(b+=8),a.frame=b,null!==a.item&&(a.item.frame=b)),null===a.item&&this.createItem(a))},b.prototype.createItem=function(a){var b=null,c=a.j*this.config.blockWidth,d=this.height+a.l*this.config.levelHeight;null===a.item&&(null===a.item&&a.frame>0&&(b=this.items.getFirstExists(!1),b.reset(c,d),b.frame=a.frame,a.item=b,b.cell=a),(null===a.frame||a.frame>0)&&this.createBackground(a,c,d))},b.prototype.createBackground=function(a,b,c){var d=null;0===a.frame||this.hasBackground(a)||(this.hasBackground(a.neighbors.left)?(d=a.neighbors.left.background,d.width+=this.config.blockWidth):this.hasBackground(a.neighbors.right)?(d=a.neighbors.right.background,d.x-=this.config.blockWidth,d.tilePosition.x=-b,d.width+=this.config.blockWidth):(d=this.background.next(),d.reset(b,c),d.tilePosition.x=-b,d.tilePosition.y=-c+this.backgroundScroll,d.width=this.config.blockWidth,d.height=this.config.levelHeight),a.background=d)},b.prototype.update=function(a){var b=4,c=0;a.sprite.alive||(b=1),this.items.y-=b,this.background.y-=b,this.explosions.y-=b,this.blockfield.tilePosition.y=this.items.y%this.config.levelHeight,this.backgroundScroll=Math.floor(this.items.y/8);var d=function(a){a.tilePosition.y=-a.y+this.backgroundScroll}.bind(this);this.background.forEach(d),c=Math.floor(-this.items.y/this.config.levelHeight)+1,c>a.level&&(a.updateLevel(c),this.updateLevel(c))},b.prototype.updateLevel=function(a){var b=0,c=0,d=0,e=0,f=0,g=null,h=null,i=null;for(this.autocorrelation=this.autocorrelation*this.config.decay,this.lfo1period=this.lfo1period*this.config.decay,this.lfo2period=this.lfo2period*this.config.decay*this.config.decay,this.random=(1-this.autocorrelation)*Math.random()+this.autocorrelation*this.random,c=(Math.sin(2*a*Math.PI/this.lfo1period)+1)/2,d=(Math.sin(2*a*Math.PI/this.lfo2period)+1)/2,e=(c/3+d/3+this.random/3)*(this.nBlocks-4)+2,f=Math.round(3*Math.random())+3,this.previousRow=this.lastRow,this.lastRow=new Array(this.nBlocks),b=0;b<this.nBlocks;b++){if(g=null,h=null,b<Math.max(1,e-f/2)||b>Math.min(this.nBlocks-2,e+f/2))h=0;else{var j=Math.random();j>.999?h=this.frames.BONUS:j>.995?h=this.frames.HEALTH:j>.98&&(h=this.frames.ENERGY)}g={item:null,j:b,l:a,frame:h,neighbors:{top:null,left:null,right:null,bottom:null}},this.lastRow[b]=g}for(b=0;b<this.nBlocks;b++)null!==this.lastRow[b]&&(this.lastRow[b].neighbors.left=this.lastRow[((b-1)%this.nBlocks+this.nBlocks)%this.nBlocks],this.lastRow[b].neighbors.right=this.lastRow[(b+1)%this.nBlocks],this.lastRow[b].neighbors.top=this.previousRow[b]),null!==this.previousRow[b]&&(this.previousRow[b].neighbors.bottom=this.lastRow[b]);if(0!==a){for(b=0;b<this.nBlocks;b++)this.updateFrame(this.previousRow[b]);i=function(a){null!==a&&null!==a.body&&a.body.y<0&&this.kill(a,!1)}.bind(this),this.items.forEachAlive(i,this)}},b.prototype.isBlock=function(a){return null!==a&&null!==a.frame&&a.frame<this.frames.HEALTH},b.prototype.hasBackground=function(a){return"undefined"!=typeof a.background&&null!==a.background},b.prototype.explode=function(a){this.sounds.hit.play();var b=this.explosions.getFirstExists(!1);b&&(b.reset(a.body.x+a.body.width/2,-this.items.y+a.body.y+a.body.height/2),b.play("kaboom",30,!1,!0))},a.Earth=b}(App);